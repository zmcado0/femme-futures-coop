<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic page information (DON'T CHANGE) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- üìù CHANGE THIS: Your website title (appears in browser tabs) -->
    <title>Femme Futures Cooperative</title>
    
    <!-- üîç SEO: Helps Google understand your website -->
    <meta name="description" content="Building a cooperative economy where women support each other's success through shared resources, knowledge, and mutual aid.">
    <meta name="keywords" content="cooperative, women, economic empowerment, community, newsletter">
    <meta name="author" content="Femme Futures Cooperative">
    
    <!-- üì± Social Media: How your site looks when shared -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Femme Futures Cooperative">
    <meta property="og:description" content="A conscious guide to surviving capitalism">
    <meta property="og:site_name" content="Femme Futures Cooperative">
    
    <!-- üå∏ Website icon (the little picture in browser tabs) -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üå∏</text></svg>">
    
    <!-- üé® Google Fonts: Makes text look pretty -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <!-- üé® CSS: Makes everything look beautiful -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 
    ========================================
    üè† WEBSITE HEADER (Professional banner at top)
    ========================================
    üìù TO CUSTOMIZE: Change the text below
    -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div>
                    <!-- üìù CHANGE THIS: Your main website title -->
                    <h1 class="main-title">Femme Futures Cooperative</h1>
                    <!-- üìù CHANGE THIS: Your subtitle/description -->
                    <p class="subtitle">A Conscious Guide to Surviving Capitalism</p>
                </div>
                <!-- Simple, clean header -->
            </div>
        </div>
    </header>

    <!-- 
    ========================================
    üì∞ MAIN WEBSITE CONTENT
    ========================================
    This is where your newsletters appear
    -->
    <div id="mainContent" class="main-content">
        <div class="container">
            <div class="grid">
                <!-- LEFT SIDE: Newsletter list and search -->
                <div class="content-column">
                    <!-- üîç Search box -->
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Search newsletters..." class="search-input">
                    </div>

                    <!-- üì∞ Newsletter cards appear here automatically -->
                    <div id="newsletterArchive" class="newsletter-archive">
                        <!-- Loading message (disappears when newsletters load) -->
                        <div id="loadingState" class="newsletter-card loading">
                            <h2 class="newsletter-title">üì• Loading Newsletters...</h2>
                            <p class="newsletter-excerpt">Please wait while we load your newsletters from the server.</p>
                            <div class="loading-details">
                                <small>‚Ä¢ Checking newsletters.json file...</small><br>
                                <small>‚Ä¢ Loading .docx files from Newsletters folder...</small><br>
                                <small>‚Ä¢ Processing document content...</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT SIDE: Information and signup -->
                <div class="sidebar">
                    <!-- 
                    üìù ABOUT SECTION - CUSTOMIZE THIS!
                    Change the text below to describe YOUR organization
                    -->
                    <div class="sidebar-card">
                        <h3 class="sidebar-title">About Femme Futures Cooperative</h3>
                        <p class="sidebar-text">
                            Being a young person navigating both the workplace and capitalism comes with so many challenges. 
                            This is a space to come together around those challenges and be in community.
                        </p>
                        <p class="sidebar-small">
                            A community-driven initiative focused on empowerment, 
                            collaboration, and sustainable futures.
                        </p>
                    </div>

                    <!-- üìß Email signup form -->
                    <div class="sidebar-card signup-card">
                        <h3 class="sidebar-title">Subscribe to Newsletter</h3>
                        <!-- üìù CHANGE THIS: Your signup description -->
                        <p class="sidebar-text">
                            Get access to my weekly thoughts and insights on surviving capitalism.
                        </p>
                        
                        <!-- Success message (hidden until someone subscribes) -->
                        <div id="successMessage" class="success-message hidden">
                            Thanks for subscribing! Welcome to the cooperative.
                        </div>
                        
                        <!-- Email signup form -->
                        <div class="signup-form">
                            <input type="email" id="emailInput" placeholder="Enter your email" class="email-input">
                            <button id="subscribeBtn" class="subscribe-btn">
                                <span class="icon">‚úâÔ∏è</span>
                                <span>Subscribe</span>
                            </button>
                        </div>
                    </div>

                    <!-- 
                    üí∞ SUPPORT/DONATION SECTION
                    üìù TO CUSTOMIZE: Update the link in the href below to your actual support page
                    -->
                    <div class="sidebar-card coffee-card">
                        <h3 class="sidebar-title">Support This Newsletter</h3>
                        <p class="sidebar-text">
                            I say some vulnerable shit. If you think that is valuable, consider buying me a coffee to support 
                            continued research and writing.
                        </p>
                        <!-- üö® IMPORTANT: Change this link to your actual support/donation page -->
                        <a href="#" onclick="alert('Support link not configured yet. Please update this link in index.html'); return false;" class="coffee-btn">
                            <span class="icon">‚òï</span>
                            <span>Support Our Work</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 
    ========================================
    üìñ FULL NEWSLETTER VIEW
    ========================================
    This appears when someone clicks on a newsletter
    (Hidden by default)
    -->
    <div id="newsletterDetail" class="newsletter-detail hidden">
        <div class="container">
            <!-- Back button -->
            <button id="backBtn" class="back-btn">
                ‚Üê Back to Archive
            </button>
            
            <!-- Full newsletter content -->
            <article class="newsletter-article">
                <h1 id="detailTitle" class="article-title"><!-- Newsletter title goes here --></h1>
                <div class="article-date">
                    <span class="icon">üìÖ</span>
                    <span id="detailDate"><!-- Newsletter date goes here --></span>
                </div>
                
                <div id="detailContent" class="article-content">
                    <!-- Full newsletter content goes here -->
                </div>
            </article>
        </div>
    </div>

    <!-- 
    ========================================
    üîß JAVASCRIPT LIBRARIES & DEBUGGING
    ========================================
    These make the website work (DON'T CHANGE)
    -->
    <!-- Library for reading Word documents -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    
    <!-- Enhanced debugging and newsletter loading script -->
    <script>
        /**
         * üå∏ FEMME FUTURES COOPERATIVE - ENHANCED NEWSLETTER WEBSITE
         * 
         * This JavaScript handles:
         * - Loading newsletters from .docx files in the Newsletters/ folder
         * - Enhanced error handling and debugging
         * - Better loading states and user feedback
         */

        // Newsletter data and state
        let newsletters = [];
        let currentSearch = '';

        // DOM elements
        let newsletterArchive, searchInput, emailInput, subscribeBtn, loadingState;
        let newsletterDetail, mainContent, backBtn, detailTitle, detailDate, detailContent;

        // Debug logging
        function debugLog(message, data = null) {
            console.log(`[Newsletter Debug] ${message}`, data || '');
        }

        // Initialize the website when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Website initialized, starting setup...');
            initializeElements();
            setupEventListeners();
            loadNewsletters();
        });

        /**
         * Get references to DOM elements
         */
        function initializeElements() {
            // Main content elements
            newsletterArchive = document.getElementById('newsletterArchive');
            searchInput = document.getElementById('searchInput');
            emailInput = document.getElementById('emailInput');
            subscribeBtn = document.getElementById('subscribeBtn');
            loadingState = document.getElementById('loadingState');
            
            // Detail view elements
            newsletterDetail = document.getElementById('newsletterDetail');
            mainContent = document.getElementById('mainContent');
            backBtn = document.getElementById('backBtn');
            detailTitle = document.getElementById('detailTitle');
            detailDate = document.getElementById('detailDate');
            detailContent = document.getElementById('detailContent');
            
            debugLog('DOM elements initialized');
        }

        /**
         * Set up event listeners for interactivity
         */
        function setupEventListeners() {
            // Search functionality
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
                debugLog('Search listener added');
            }
            
            // Email subscription
            if (subscribeBtn) {
                subscribeBtn.addEventListener('click', handleSubscription);
                debugLog('Subscribe button listener added');
            }
            
            if (emailInput) {
                emailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSubscription();
                    }
                });
                debugLog('Email input listener added');
            }
            
            // Back button for newsletter detail
            if (backBtn) {
                backBtn.addEventListener('click', showMainContent);
                debugLog('Back button listener added');
            }
        }

        /**
         * Load newsletters from the JSON file and .docx files
         */
        async function loadNewsletters() {
            try {
                debugLog('Starting to load newsletters...');
                updateLoadingState('Loading newsletter list...');
                
                // Load the list of newsletter files
                const response = await fetch('newsletters.json');
                if (!response.ok) {
                    throw new Error(`Failed to load newsletters.json: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('Newsletter files found in JSON:', data.files);
                
                if (!data.files || !Array.isArray(data.files) || data.files.length === 0) {
                    throw new Error('newsletters.json is empty or malformed');
                }
                
                updateLoadingState(`Loading ${data.files.length} newsletter files...`);
                
                // Load each newsletter file from the Newsletters folder
                newsletters = [];
                for (let i = 0; i < data.files.length; i++) {
                    const filename = data.files[i];
                    updateLoadingState(`Loading ${i + 1} of ${data.files.length}: ${filename}`);
                    
                    try {
                        const newsletter = await loadDocxFile(filename);
                        if (newsletter) {
                            newsletters.push(newsletter);
                            debugLog(`Successfully loaded: ${newsletter.title}`);
                        }
                    } catch (error) {
                        debugLog(`Failed to load ${filename}:`, error.message);
                        // Continue loading other newsletters even if one fails
                    }
                }
                
                if (newsletters.length === 0) {
                    throw new Error('No newsletters could be loaded');
                }
                
                // Sort newsletters by date (newest first)
                newsletters.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                debugLog(`Successfully loaded ${newsletters.length} newsletters`);
                displayNewsletters();
                
            } catch (error) {
                debugLog('Error loading newsletters:', error.message);
                showErrorState(error.message);
            }
        }

        /**
         * Update loading state message
         */
        function updateLoadingState(message) {
            if (loadingState) {
                const excerpt = loadingState.querySelector('.newsletter-excerpt');
                if (excerpt) {
                    excerpt.textContent = message;
                }
            }
        }

        /**
         * Load and parse a single .docx file
         */
        async function loadDocxFile(filename) {
            try {
                // Add the Newsletters/ folder path
                const filepath = `Newsletters/${filename}`;
                debugLog(`Attempting to load: ${filepath}`);
                
                const response = await fetch(filepath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                
                // Use mammoth.js to extract text from .docx file
                const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                const content = result.value;
                
                if (!content || content.trim().length === 0) {
                    throw new Error('Document appears to be empty');
                }
                
                // Create newsletter object
                const newsletter = {
                    id: filename.replace(/\.[^/.]+$/, "").replace(/\s+/g, '-'), // Remove extension and spaces
                    title: extractTitle(content, filename),
                    content: content,
                    excerpt: extractExcerpt(content),
                    date: extractDate(content, filename),
                    filename: filename,
                    filepath: filepath
                };
                
                return newsletter;
                
            } catch (error) {
                debugLog(`Error loading ${filename}:`, error.message);
                throw error;
            }
        }

        /**
         * Extract title from document content or use filename
         */
        function extractTitle(content, filename) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            // Use first non-empty line as title, or filename as fallback
            if (lines.length > 0 && lines[0].length <= 100) {
                return lines[0];
            }
            
            // Clean up filename for title
            return filename
                .replace(/\.[^/.]+$/, "") // Remove extension
                .replace(/[-_]/g, " ") // Replace dashes and underscores with spaces
                .replace(/\b\w/g, l => l.toUpperCase()); // Capitalize words
        }

        /**
         * Extract excerpt from document content
         */
        function extractExcerpt(content) {
            const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            // Skip first line (title) and get next few lines for excerpt
            const excerptLines = lines.slice(1, 4); // Get lines 2-4
            let excerpt = excerptLines.join(' ');
            
            // Limit excerpt length
            if (excerpt.length > 200) {
                excerpt = excerpt.substring(0, 200) + '...';
            }
            
            return excerpt || 'Click to read this newsletter...';
        }

        /**
         * Extract or generate date for newsletter
         */
        function extractDate(content, filename) {
            // Try to find a date in the content
            const dateRegex = /\b(January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2},?\s+\d{4}\b/i;
            const dateMatch = content.match(dateRegex);
            
            if (dateMatch) {
                return new Date(dateMatch[0]).toLocaleDateString();
            }
            
            // Try to extract date from filename
            const fileNameDateRegex = /(\d{4}[-_]\d{2}[-_]\d{2})/;
            const fileNameMatch = filename.match(fileNameDateRegex);
            if (fileNameMatch) {
                return new Date(fileNameMatch[0].replace(/[-_]/g, '/')).toLocaleDateString();
            }
            
            // Fallback to current date
            return new Date().toLocaleDateString();
        }

        /**
         * Display newsletters in the archive
         */
        function displayNewsletters() {
            if (!newsletterArchive) return;
            
            // Hide loading state
            if (loadingState) {
                loadingState.style.display = 'none';
            }
            
            // Filter newsletters based on search
            const filteredNewsletters = newsletters.filter(newsletter => 
                newsletter.title.toLowerCase().includes(currentSearch.toLowerCase()) ||
                newsletter.excerpt.toLowerCase().includes(currentSearch.toLowerCase()) ||
                newsletter.content.toLowerCase().includes(currentSearch.toLowerCase())
            );
            
            // Clear existing content (except loading state)
            const existingCards = newsletterArchive.querySelectorAll('.newsletter-card:not(#loadingState)');
            existingCards.forEach(card => card.remove());
            
            if (filteredNewsletters.length === 0) {
                const noResultsCard = document.createElement('div');
                noResultsCard.className = 'newsletter-card';
                noResultsCard.innerHTML = `
                    <h2 class="newsletter-title">No newsletters found</h2>
                    <p class="newsletter-excerpt">
                        ${currentSearch ? 'Try a different search term.' : 'No newsletters available yet.'}
                    </p>
                `;
                newsletterArchive.appendChild(noResultsCard);
                return;
            }
            
            // Create newsletter cards
            filteredNewsletters.forEach(newsletter => {
                const card = createNewsletterCard(newsletter);
                newsletterArchive.appendChild(card);
            });
            
            debugLog(`Displayed ${filteredNewsletters.length} newsletters`);
        }

        /**
         * Create a newsletter card element
         */
        function createNewsletterCard(newsletter) {
            const card = document.createElement('div');
            card.className = 'newsletter-card';
            
            card.innerHTML = `
                <div class="newsletter-date">
                    <span class="icon">üìÖ</span>
                    ${newsletter.date}
                </div>
                <h2 class="newsletter-title">${newsletter.title}</h2>
                <p class="newsletter-excerpt">${newsletter.excerpt}</p>
                <button class="read-more-btn" onclick="showNewsletterDetail('${newsletter.id}')">
                    <span class="icon">üìñ</span>
                    <span>Read Full Newsletter</span>
                </button>
            `;
            
            return card;
        }

        /**
         * Show full newsletter detail
         */
        function showNewsletterDetail(newsletterId) {
            const newsletter = newsletters.find(n => n.id === newsletterId);
            if (!newsletter) {
                debugLog(`Newsletter not found: ${newsletterId}`);
                return;
            }
            
            // Populate detail view
            if (detailTitle) detailTitle.textContent = newsletter.title;
            if (detailDate) detailDate.textContent = newsletter.date;
            if (detailContent) {
                // Format content for better display
                detailContent.innerHTML = newsletter.content
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .map(line => `<p>${line}</p>`)
                    .join('');
            }
            
            // Show detail view, hide main content
            if (newsletterDetail) newsletterDetail.classList.remove('hidden');
            if (mainContent) mainContent.classList.add('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
            debugLog(`Showing newsletter: ${newsletter.title}`);
        }

        /**
         * Show main content, hide newsletter detail
         */
        function showMainContent() {
            if (newsletterDetail) newsletterDetail.classList.add('hidden');
            if (mainContent) mainContent.classList.remove('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
            debugLog('Returned to main content');
        }

        /**
         * Handle search input
         */
        function handleSearch(event) {
            currentSearch = event.target.value;
            debugLog(`Search query: "${currentSearch}"`);
            displayNewsletters();
        }

        /**
         * Handle email subscription
         */
        function handleSubscription() {
            if (!emailInput || !subscribeBtn) return;
            
            const email = emailInput.value.trim();
            
            if (!email) {
                alert('Please enter your email address.');
                return;
            }
            
            if (!isValidEmail(email)) {
                alert('Please enter a valid email address.');
                return;
            }
            
            // Simulate subscription (you can integrate with your email service here)
            debugLog('Newsletter subscription:', email);
            
            // Show success message
            const successMessage = document.getElementById('successMessage');
            if (successMessage) {
                successMessage.classList.remove('hidden');
                setTimeout(() => {
                    successMessage.classList.add('hidden');
                }, 5000);
            }
            
            // Clear input
            emailInput.value = '';
        }

        /**
         * Validate email address
         */
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        /**
         * Show error state when newsletters fail to load
         */
        function showErrorState(errorMessage) {
            if (!newsletterArchive) return;
            
            // Hide loading state
            if (loadingState) {
                loadingState.style.display = 'none';
            }
            
            const errorCard = document.createElement('div');
            errorCard.className = 'newsletter-card';
            errorCard.innerHTML = `
                <h2 class="newsletter-title">‚ö†Ô∏è Unable to Load Newsletters</h2>
                <p class="newsletter-excerpt">
                    <strong>Error:</strong> ${errorMessage}
                </p>
                <div class="error-details">
                    <h4>Troubleshooting Steps:</h4>
                    <ul style="margin: 1rem 0; padding-left: 2rem; color: #666; text-align: left;">
                        <li>Check that <code>newsletters.json</code> file exists in the root folder</li>
                        <li>Verify that .docx files are in the <code>Newsletters/</code> folder</li>
                        <li>Make sure you're running this on a web server (not file://)</li>
                        <li>Check the browser console (F12) for detailed error messages</li>
                        <li>Ensure newsletter filenames in JSON match actual file names</li>
                    </ul>
                </div>
                <button class="read-more-btn" onclick="location.reload()">
                    <span class="icon">üîÑ</span>
                    <span>Try Again</span>
                </button>
            `;
            
            newsletterArchive.innerHTML = '';
            newsletterArchive.appendChild(errorCard);
        }

        /**
         * Make functions available globally
         */
        window.showNewsletterDetail = showNewsletterDetail;
        window.debugLog = debugLog;
        
        // Add helpful debugging info to console
        debugLog('Newsletter website loaded. Available debug commands:');
        debugLog('- window.newsletters: View loaded newsletter data');
        debugLog('- window.debugLog(message): Log debug messages');
        
        // Make newsletters available for debugging
        Object.defineProperty(window, 'newsletters', {
            get: function() { return newsletters; }
        });
        
    </script>
</body>
</html>
